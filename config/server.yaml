# 0Trust Server Configuration

# Log level configuration
log_level: "INFO"

# Core server settings
server:
  listen_addr: ":8443"
  cert_file: "/config/certs/server.crt"
  key_file: "/config/certs/server.key"
  ca_file: "/config/certs/ca.crt"

# API server settings (for HTTP proxy from Caddy)
api:
  listen_addr: "localhost:9443"

# Caddy reverse proxy settings
caddy:
  admin_api: "http://localhost:2019"
  config_dir: "/config/caddy"
  storage_dir: "/config/caddy/storage"

  # Caddy logging configuration
  logging:
    enabled: true
    level: "INFO" # DEBUG, INFO, WARN, ERROR
    format: "console" # json, console, single_field, filter, or custom encoder
    output: "stdout" # stdout, stderr, discard, or file path (e.g., "/var/log/caddy.log")

    # Fields to include in logs (for structured logging)
    include:
      - "user_id"
      - "duration"
      - "size"
      - "status"
      - "method"
      - "uri"
      - "host"
      - "resp_headers>Server"

    # Fields to exclude from logs (for privacy/security)
    exclude:
      - "headers" # All request headers
      - "request>headers>Authorization" # Authorization header specifically
      - "request>headers>Cookie" # Cookie header
      - "request>body" # Request body content

    # Custom fields to add to every log entry
    fields:
      component: "caddy-proxy"
      environment: "production"

    # Log sampling (reduce log volume for high-traffic)
    # sampling_first: 100        # Log first N requests normally
    # sampling_thereafter: 100   # Then log every Nth request
